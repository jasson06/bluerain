<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Details</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  

</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2 class="home-option"><a href="/dashboard">Home</a></h2>
    </div>
    
    <!-- Quick Section Navigation -->
    <div class="sidebar-nav-container">
      <ul class="sidebar-nav">
        <li><a href="#" class="sidebar-nav-link" id="jobs-nav-link"><i class="fas fa-briefcase"></i> Jobs</a></li>
  <li><a href="#tasks-section" class="sidebar-nav-link" data-section="tasks-section"><i class="fas fa-tasks"></i> Tasks</a></li>
  <li><a href="#estimates-section" class="sidebar-nav-link" data-section="estimates-section"><i class="fas fa-file-invoice-dollar"></i> Estimates</a></li>
  <li><a href="#" class="sidebar-nav-link" data-external="true" onclick="window.location.href = '/qccontrol.html?projectId=' + (getProjectId() || localStorage.getItem('currentProjectId') || ''); return false;"><i class="fas fa-clipboard-check"></i> QC Review</a></li>
  <li><a href="#files-section" class="sidebar-nav-link" data-section="files-section"><i class="fas fa-folder-open"></i> Files & Photos</a></li>
  <li><a href="/schedule.html" class="sidebar-nav-link" data-external="true"><i class="far fa-calendar-alt"></i> Schedule</a></li>
  <li><a href="/Selection-Board.html" class="sidebar-nav-link" data-external="true"><i class="fas fa-th-large"></i> Selection Boards</a></li>
      </ul>
    </div>
  
  </div>
  
  

  <!-- Main Container -->
  <div class="container">
  
    <h1 id="project-title">
      Project Alpha
      <button id="toggle-details-btn" class="dropdown-toggle">‚ñº</button>
      <!-- Edit Project Button -->
    </h1>

    <div class="upper-bar"> 
      <div class="project-info">
        <div class="project-icon" style="background-color: #ff5733;">
          J
        </div>
        <span class="project-name">BlueRain Group</span>
      </div>
    
      <button class="invite-btn" onclick="openInviteModal()">
        <i class="fas fa-user-plus"></i> Invite Team
      </button>
    
      <button class="manage-btn" onclick="openModal()">
        <i class="fas fa-users-cog"></i> Manage Vendors
      </button>

      <div class="maintenance-notification-wrapper" style="position: relative;">
  <button id="maintenanceNotifBtn" class="notif-icon-btn" style="position: relative;">
    <i class="fas fa-tools"></i>
    <span id="maintenanceNotifCount" class="notif-count-badge" style="display:none;">0</span>
  </button>
  <div id="maintenanceNotifDropdown" class="notif-dropdown" style="display:none;">
    <div class="notif-dropdown-header">
      <strong>Maintenance Requests</strong>
    </div>
    <div id="maintenanceNotifList" class="notif-list"></div>
  </div>
</div>
    </div>

    <div id="project-details">
      <div class="project-details-content" style="display: none;">
        <p><strong>Status:</strong> In Progress</p>
        <p><strong>Address:</strong> 123 Main St, New York, NY</p>
        <p><strong>Description:</strong> A description of the project.</p>
        <p><strong>Project Code:</strong> PA123</p>
        <p><strong>Type:</strong> Construction</p>
        <p><strong>Color:</strong>
          <span style="display: inline-block; background-color: #ff5733; width: 15px; height: 15px; border-radius: 50%; margin-right: 5px;"></span>#ff5733
        </p>
        <p><strong>Zip Code:</strong> 10001</p>
    
        <!-- Edit Project Button -->
        <button id="edit-project-button" class="btn-primary" onclick="openEditProjectModal()">Edit Project</button>
      </div>
    </div>

    <!-- Tasks Section -->
    <section id="tasks-section" class="details-section">
      <div class="section-header">
        <h2>
          Tasks <span id="task-count">(0)</span>
        </h2>
        <button class="add-button" onclick="createNewTask()">+ Create New Task</button>
      </div>
      <ul id="task-list">
        <!-- Example Task Item -->
        <li class="task-item" data-task-id="taskIdHere">
          <div class="task-info">
            <span class="task-title">Task Name</span>
          </div>
          <div class="task-actions">
            <span class="delete-icon" onclick="deleteTask('taskIdHere')">
              <i class="fas fa-trash"></i>
            </span>
            <button class="edit-task-button" data-task-id="taskIdHere">Edit</button>
          </div>

          <div class="task-meta">
            <span class="task-assigned-to" title="Unassigned">NA</span>
            <span class="task-status status-pending">Pending</span>
          </div>
          <div class="task-extra-actions">
            <button class="assign-to-button" onclick="openAssignModal('taskIdHere')" title="Assign">
              <i class="fas fa-user-plus"></i>
            </button>
            <button class="add-due-date-button" onclick="openDueDatePicker('taskIdHere')" title="Add Due Date">
              <i class="fas fa-calendar"></i>
            </button>
            
            <span class="task-due-date">Due: Not Set</span>
          </div>
        </li>
      </ul>
      
    </section>

    <!-- Task Details Modal/Side Section -->
    <div id="task-details" class="task-details-section" style="display: none;">
      <h3>Task Details</h3>

      <!-- Task Status Toggle Button -->
      <div id="task-status-button" class="task-status">
        <button id="task-status-toggle" class="mark-completed-button" onclick="toggleTaskStatus()">
          Mark as Completed
        </button>
      </div>

      <div id="task-info">
        <p><strong>Title:</strong> <span id="task-title"></span></p>
        <p><strong>Description:</strong> <span id="task-description"></span></p>
        <p><strong>Due Date:</strong> <span id="task-due-date"></span></p>
        <p><strong>Assigned To:</strong> <span id="task-assigned-to"></span></p>
      </div>


      <div id="task-comments-section" class="task-comments-section" data-task-id="">
        <h4>Comments</h4>
        <div id="comments-list">
          <p>No comments yet.</p>
        </div>
        <textarea
          id="new-comment"
          class="comment-input"
          placeholder="Add a comment..."
        ></textarea>
        <button id="add-comment-button" class="btn-primary">Add Comment</button>
      </div>
      
      


      <div class="photo-section">
        <div class="upload-tile" onclick="document.getElementById('before-upload').click();">
          <div class="upload-icon">+</div>
          <span>Before</span>
          <input
            type="file"
            id="before-upload"
            class="hidden-file-input"
            multiple
            onchange="handlePhotoUpload(event, 'before')"
          />
        </div>
        <div id="before-photo-preview" class="photo-preview"></div>
      </div>
      <div class="photo-section">
        <div class="upload-tile" onclick="document.getElementById('after-upload').click();">
          <div class="upload-icon">+</div>
          <span>After</span>
          <input
            type="file"
            id="after-upload"
            class="hidden-file-input"
            multiple
            onchange="handlePhotoUpload(event, 'after')"
          />
        </div>
        <div id="after-photo-preview" class="photo-preview"></div>
      </div>

      <button id="edit-task-btn" onclick="openEditTaskModal()">Edit Task</button>
      <button id="delete-task-btn" onclick="deleteTask()">Delete Task</button>
      <button class="close-task-details" onclick="closeTaskDetails()">Close</button>
    </div>

    <!-- Modal for displaying larger images -->
    <div id="photo-modal" class="modal" style="display: none;">
      <span id="close-photo-modal" class="close-button" onclick="closePhotoModal()">&times;</span>
      <img id="photo-modal-img" class="modal-content" alt="Large Photo" />
    </div>

<!-- Estimates Section -->
<section id="estimates-section" class="details-section">
  <h2>Estimates <span id="estimates-count">(0)</span></h2>
  <div id="estimates-list-scroll" style="max-height: 565px; overflow-y: auto; margin-bottom: 16px;">
    <div id="estimates-list">
      <!-- Estimates will be dynamically loaded here -->
      <p>No estimates found.</p>
    </div>
  </div>
  <div class="estimates-options">

    <!-- Click-toggle Dropdown -->
    <div class="dropdown">
      <button class="dropdown-togglet" onclick="toggleDropdownt()">Create New</button>
      <div class="dropdown-menu" id="estimateDropdown" style="display: none;">
        <div class="dropdown-item" onclick="startFromScratch(); closeDropdown()">‚ûï Start from Scratch</div>
        <div class="dropdown-item" onclick="importEstimate(); closeDropdown()">üì§ Import Estimate</div>
        <div class="dropdown-item" onclick="downloadTemplate(); closeDropdown()">üì• Download Template</div>
      </div>
    </div>
    
    <!-- Remaining Options -->
    <div class="estimate-option" id="financial-report-button">
      üìò Open Financial Report
    </div>

    <div class="estimate-option budget-button" style="cursor: default;">
      üí∞ <strong>Total Budget:</strong><br>
      <span id="total-budget">$0.00</span>
    </div>

  </div>
</section>



  <!-- ‚úÖ Dedicated Quality Control Review Section -->

<section id="quality-control-section" style="margin-top: 30px; padding: 20px; background: #ffffff; border: 1px solid #ddd; border-radius: 10px;">
  <h2 style="color: #0f4c75; font-size: 24px; margin-bottom: 10px;">üõ†Ô∏è Quality Control Review</h2>
  <p style="color: #666; font-size: 14px;">Review summary of completed work below. Navigate to the QC Control page for detailed review and actions.</p>
  
  <div id="quality-review-items" style="margin-top: 20px;">
    <p style="color:#aaa;">Loading summary...</p>
  </div>
</section>




<!-- Files Section -->
<section id="files-section" class="details-section">
  <h2>Files & Photos</h2>
  <div class="upload-box">
    <button class="upload-button" onclick="uploadFiles()">Upload Files ‚ñº</button>
    <p>Upload images, files, and more to share with your team.</p>
  </div>
  <div id="dropzone" class="dropzone" ondrop="handleDrop(event)" ondragover="event.preventDefault();">
    Drag and drop files here or click to upload
  </div>

  <!-- Action Dropdown -->
  <div id="file-actions" class="action-dropdown" style="display: none;">
    <select id="file-action-select">
      <option value="" disabled selected>Select Action</option>
      <option value="download">Download</option>
      <option value="delete">Delete</option>
    </select>
    <button onclick="performFileAction()">Apply</button>
  </div>

  <!-- Select All Checkbox -->
  <div>
    <label>
      <input type="checkbox" id="select-all" onclick="selectAllFiles()"> Select All
    </label>
  </div>

  <div id="file-section">
    <div id="file-loader" style="display:none;justify-content:center;align-items:center;height:60px;">
      <div class="spinner"></div>
    </div>
    <div id="uploaded-files-container"></div>
  </div>
  <div id="file-preview-popup" class="file-preview-popup"></div>
</section>





    <!-- Schedule Section -->
    <section id="schedule-section" class="details-section">
      <h2>Schedule</h2>
      <button class="create-schedule-button" onclick="createSchedule()">Create Schedule</button>
      <p>Start building out your project schedule.</p>
    </section>
    

    <!-- Selection Boards Section -->
    <section id="selection-boards-section" class="details-section">
      <h2>Selection Boards</h2>
      <p>Select which rooms you'd like to design first.</p>
      <button class="selection-button" onclick="customizeSelection()">Customize Selection Boards</button>
    </section>
  </div>




      <!-- Edit Project Modal -->
<div id="edit-project-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>Edit Project</h3>
    <form id="edit-project-form">
      <label for="edit-project-name">Name:</label>
      <input id="edit-project-name" type="text" required />
      
      <label for="edit-project-status">Status:</label>
      <select id="edit-project-status" required>
        <option value="Upcoming">Upcoming</option>
        <option value="In Progress">In Progress</option>
        <option value="On Market">On Market</option>
        <option value="completed">Completed</option>  
      </select>

      <label for="edit-project-color">Color:</label>
      <input id="edit-project-color" type="color" />

<!-- Replace your current Project Type input in the Edit Project Modal with this: -->
<div class="form-group">
  <label for="edit-project-type"><strong>Project Type</strong></label>
  <select id="edit-project-type" class="form-control" required>
    <option value="Residential">Residential</option>
    <option value="Multifamily">Multifamily</option>
  </select>
</div>

      <label for="edit-project-code">Lockbox Code:</label>
      <input id="edit-project-code" type="text" required />

      <label for="edit-project-addressLine1">Address Line 1:</label>
      <input id="edit-project-addressLine1" type="text" />

      <label for="edit-project-addressLine2">Address Line 2:</label>
      <input id="edit-project-addressLine2" type="text" />

       <label for="edit-project-city">City:</label>
       <input id="edit-project-city" type="text" required />

      <label for="edit-project-state">State:</label>
      <input id="edit-project-state" type="text" required />

      <label for="edit-project-zip">Zip Code:</label>
      <input id="edit-project-zip" type="text" />


      <label for="edit-project-description">Description:</label>
      <textarea id="edit-project-description"></textarea>

      <div class="modal-buttons">
        <button type="button" onclick="submitEditProject()">Save</button>
        <button type="button" onclick="closeEditProjectModal()">Cancel</button>
        <button type="button" class="delete-button" onclick="deleteProject()">Delete Project</button>
      </div>
    </form>
  </div>
</div>

  
<!-- Modal for adding a new task -->
<div id="addTaskModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:420px;">
    <span class="close" id="closeAddTaskModal" style="position:absolute;top:6px;right:18px;font-size:1.5rem;cursor:pointer;">&times;</span>
    <h3>Add New Task</h3>
    <form id="addTaskForm">
      <label>Title:</label>
      <input type="text" id="newTaskTitle" required />
      <label>Description:</label>
      <textarea id="newTaskDesc"></textarea>
      <label>Due Date:</label>
      <input type="date" id="newTaskDueDate" />
      <label>Project:</label>
      <select id="newTaskProject" required></select>
        <label>Assign To:</label>
  <select id="newTaskAssignedTo" >
    <option value="">-- Select --</option>
  </select>
      <button type="submit" style="margin-top:12px;">Add Task</button>
    </form>
  </div>
</div>

<!-- Invite Modal -->
<div id="invite-modal" class="modal" style="display: none;">
  <div class="modal-content">
    <h3>Invite Team Member</h3>
    <form id="invite-form">
      <label for="invite-role">Role:</label>
      <select id="invite-role" required>
        <option value="vendor">Vendor</option>
        <option value="project-manager">Project Manager</option>
      </select>

     <!-- Managers and vendor Dropdown -->
       <label for="existing-Manager">Select Existing Manager:</label>
        <select id="existing-manager"></select>
      <label for="existing-vendor">Select Existing Vendor:</label>
      <select id="existing-vendor">
        
        <option value="">Select an existing vendor</option>
        <option value="new">Add New Vendor</option>
        <!-- Options will be dynamically populated -->
      </select>

      <label for="invite-email">Email:</label>
      <input id="invite-email" type="email" placeholder="Enter email" readonly required />

      <button type="button" class="btn-primary" onclick="sendInvite()">Send Invite</button>
      <button type="button" class="btn-secondary" onclick="closeInviteModal()">Cancel</button>
    </form>
  </div>
</div>


  <!-- Edit Task Modal -->
  <div id="edit-task-modal" class="modal">
    <div class="modal-content">
      <h3>Edit Task</h3>
      <form id="edit-task-form">
        <div class="form-group">
          <label for="edit-task-title">Title:</label>
          <input id="edit-task-title" type="text" required placeholder="Enter task title" />
        </div>

        <div class="form-group">
          <label for="edit-task-description">Description:</label>
          <textarea id="edit-task-description" placeholder="Enter task description" required></textarea>
        </div>

        <div class="form-group">
          <label for="edit-task-due-date">Due Date:</label>
          <input id="edit-task-due-date" type="date" required />
        </div>

        <div class="form-group">
          <label for="edit-task-assigned-to">Assigned To:</label>
          <select id="edit-task-assigned-to" required>
            <option value="">Select a vendor</option>
            <!-- Options will be dynamically loaded -->
          </select>
        </div>

        

        <div class="form-group">
          <label for="edit-task-completed">Completed:</label>
          <input id="edit-task-completed" type="checkbox" />
        </div>

        <div class="form-actions">
          <button id="save-task-button" type="button" class="btn-primary" onclick="updateTask()">Save</button>
          <button type="button" class="btn-secondary" onclick="closeEditTaskModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

<!-- Toast Notification -->
<div id="toast" style="
  position: fixed;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(to right, #0ea5e9, #3b82f6);
  color: white;
  padding: 14px 24px;
  border-radius: 8px;
  display: none;
  z-index: 9999;
  font-weight: 500;
  font-size: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: none;
"></div>

<!-- Loader Spinner -->
<div id="loader" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(2px);
  z-index: 9999;
  display: none;
  justify-content: center;
  align-items: center;
">
  <div style="
    border: 5px solid #e5e7eb;
    border-top: 5px solid #3b82f6;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    animation: spin 0.8s linear infinite;
  "></div>
</div>

<!-- Add this to your <style> block or <head> -->
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Sidebar quick nav */
.sidebar-nav { list-style: none; margin: 8px 0 16px; padding: 0; }
.sidebar-nav-link { display: block; padding: 8px 12px; border-radius: 8px; color: inherit; text-decoration: none; }
.sidebar-nav-link:hover { background: #f1f5f9; }
.sidebar-nav-link.active { background: #eaf6ff; color: #2563eb; font-weight: 600; }

/* Make sidebar scrollable */
.sidebar { max-height: 100vh; overflow-y: auto; }

/* Jobs flyout (outside sidebar) */
.jobs-flyout { position: fixed; width: 300px; max-height: 70vh; overflow-y: auto; background:#fff; border:1px solid #e5e7eb; border-radius:10px; box-shadow: 0 10px 24px rgba(2,6,23,0.18); z-index: 2000; padding: 8px; }
.jobs-flyout:before { content:""; position:absolute; left:-6px; top:12px; border-width:6px; border-style:solid; border-color: transparent #e5e7eb transparent transparent; }
.jobs-flyout:after { content:""; position:absolute; left:-5px; top:12px; border-width:6px; border-style:solid; border-color: transparent #ffffff transparent transparent; }
.jobs-flyout-search { position: sticky; top: 0; background:#fff; padding-bottom: 6px; margin-bottom: 6px; z-index: 1; }
.jobs-flyout-search .search-input { width: 100%; padding: 6px 0px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 0.92em; margin-top: -6px; }
.jobs-flyout-search .search-input:focus { outline: none; border-color: #93c5fd; box-shadow: 0 0 0 3px rgba(147,197,253,0.35); }
.jobs-status-group { background:#ffffff; border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; margin-bottom:8px; }
.jobs-status-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; font-weight:600; font-size:0.95em; }
.jobs-list { list-style:none; margin:0; padding:0; max-height: 180px; overflow-y:auto; }
.job-item { padding:6px 6px; border:1px solid #eef2f7; border-radius:8px; margin-bottom:6px; display:flex; align-items:center; gap:8px; cursor:pointer; }
.job-item:hover { background:#f8fafc; }
.job-avatar { width:22px; height:22px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:0.78em; }
.job-meta { display:flex; flex-direction:column; }
.job-name { font-weight:600; color:#0f172a; font-size:0.92em; }
.job-sub { font-size:0.74em; color:#64748b; }
.jobs-loading { color:#94a3b8; padding:6px; font-size:0.9em; }

/* Hide scrollbars in Jobs flyout (keep scrolling) */
.jobs-flyout { -ms-overflow-style: none; scrollbar-width: none; }
.jobs-flyout::-webkit-scrollbar { display: none; }
.jobs-list { -ms-overflow-style: none; scrollbar-width: none; }
.jobs-list::-webkit-scrollbar { display: none; }

/* Focus highlight on target sections */
@keyframes focusFlash {
  0% { box-shadow: 0 0 0 4px rgba(59,130,246,0.45) inset; }
  100% { box-shadow: 0 0 0 0 rgba(59,130,246,0); }
}
.focus-highlight {
  animation: focusFlash 1.4s ease;
  border-radius: 10px;
}

/* Jobs panel styles */
.jobs-panel { background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:12px 14px; margin: 8px 0 16px; box-shadow: 0 1px 6px #e5e7eb; }
.jobs-panel-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.jobs-title { font-weight:700; color:#0f172a; }
.jobs-panel-close { background:none; border:none; font-size:20px; cursor:pointer; color:#64748b; }
.jobs-panel-content { display:grid; grid-template-columns: repeat(2, minmax(220px, 1fr)); gap: 12px; }
.jobs-status-group { background:#ffffff; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; }
.jobs-status-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; font-weight:600; }
.jobs-list { list-style:none; margin:0; padding:0; max-height: 280px; overflow-y:auto; }
.job-item { padding:8px 8px; border:1px solid #eef2f7; border-radius:8px; margin-bottom:8px; display:flex; align-items:center; gap:10px; cursor:pointer; }
.job-item:hover { background:#f8fafc; }
.job-avatar { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:0.9em; }
.job-meta { display:flex; flex-direction:column; }
.job-name { font-weight:600; color:#0f172a; }
.job-sub { font-size:0.85em; color:#64748b; }
.jobs-loading { color:#94a3b8; padding:10px; }

@media (max-width: 900px) {
  .jobs-panel-content { grid-template-columns: 1fr; }
}
</style>
  
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
  <script src="/details-project.js"></script>
 
</body>
</html>
