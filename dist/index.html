<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bluerain Dashboard</title>
  <link rel="stylesheet" href="style.css">
  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
  <button class="hamburger">&#9776;</button>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <img src="https://node-mongodb-api-1h93.onrender.com/uploads/1746079988976-besf_logo_trans_white_imagek.png" alt="BESF Logo">
      


    </div>
    <nav>
      <ul>
        <li><a href="#" class="active"><i class="fas fa-home"></i> Home</a></li>
        <li>
           <!-- Create New Dropdown -->
          <div class="dropdown">
            <button class="dropdown-button">Create New</button>
            <div class="dropdown-content">
              <a href="add-client.html">Add Client</a>
            
              <a href="add-project.html">Add New Project</a> <!-- New Option -->
              <a href="createquote.html">Create Quote</a>
            </div>
          </div>
        </li>

         <li><a href="property-management.html"><i class="fas fa-building"></i> Rental Management
</a></li>
        
        <li><a href="quotes.html"><i class="fas fa-list-alt"></i> Quotes</a></li>

        <li>
          <a href="createquote.html?modal=laborCost">
            <i class="fas fa-hammer"></i> New Quote
          </a>
        </li>
        <li>
          <a href="pricinglist.html">
            <i class="fas fa-tasks"></i> pricing List
          </a>
        </li>
        
           <li><a href="clients.html"><i class="fas fa-list-alt"></i>Clients</a></li>

                 <li id="assignment-nav-item">
    <a href="#" id="open-assignment-section"><i class="fas fa-tasks"></i> Assignments</a>
        </li>
        
        <li>
          <a href="#" onclick="openSubcontractorsModal();return false;">
            <i class="fas fa-users-cog"></i> Subcontractors
          </a>
        </li>

        
        <li><a href="files.html"><i class="fas fa-folder-open"></i> Files</a></li>

    <li><a href="#" id="openCustomReport"><i class="fas fa-chart-line"></i> Reports</a></li>
    
        <li><a href="Selection-Board.html"><i class="fas fa-list-alt"></i> Selection Boards</a></li>

      </ul>
    </nav>
  </div>

  <!-- Main Content -->
    <div class="main-content">
<header>
  <div class="header-logo">
    <div class="avatar">B</div>
    <h1 id="manager-name">  <div class="project-search-bar">
    <i class="fas fa-search project-search-icon"></i>
    <input type="text" id="project-search-input" placeholder="Search jobs" autocomplete="off">
    <button type="button" id="project-search-clear" aria-label="Clear job search">&times;</button>
  </div><span 
        style="
          font-size:16px;
          font-weight:500;
          background:linear-gradient(90deg,#0056b3 0%,#0284c7 100%);
          color:#fff;
          padding:7px 16px;
          border-radius:8px;
          margin-top:8px;
          box-shadow:0 2px 8px rgba(30,64,175,0.08);
          display:none;
          letter-spacing:0.5px;
          
        "></span>
        
      <div class="maintenance-notification-wrapper" style="position: relative;">
  <button id="maintenanceNotifBtn" class="notif-icon-btn" style="position: relative;">
    <i class="fas fa-tools"></i>
    <span id="maintenanceNotifCount" class="notif-count-badge" style="display:none;">0</span>
  </button>
  <div id="maintenanceNotifDropdown" class="notif-dropdown" style="display:none;">
    <div class="notif-dropdown-header">
      <strong>Maintenance Requests</strong>
    </div>
    <div id="maintenanceNotifList" class="notif-list"></div>
  </div>
</div>
  </div>
      
<div class="tab-container">
    <button class="tab active" data-tab="upcoming">
        Upcoming Projects <span id="upcoming-count">0</span>
    </button>
    <button class="tab" data-tab="in-progress">
        In Progress <span id="in-progress-count">0</span>
    </button>
    <button class="tab" data-tab="on-market">
        On Market <span id="on-market-count">0</span>
    </button>
    <button class="tab" data-tab="completed">
        Completed <span id="completed-count">0</span>
    </button>
</div>

  <div id="project-search-no-results" class="project-search-no-results">No matching jobs.</div>
    
      <div class="columns-container">
        <div class="column" id="Upcoming-projects-column">
            <h3>Upcoming Projects</h3>
            <div id="Upcoming-projects-list"></div>
        </div>
    
        <div class="column" id="projects-column">
            <h3>In Progress</h3>
            <div id="projects-list"></div>
        </div>

        <div class="column" id="on-market-column">
          <h3>On Market</h3>
          <div id="on-market-projects-list"></div>
      </div>
    
        <div class="column" id="completed-projects-column">
            <h3>Completed</h3>
            <div id="completed-projects-list"></div>
        </div>
    </div>


  <section id="assignments-section" style="margin-top: 40px;">
  <h2>Assignments</h2>
  <div id="assignments-filters" style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
    <input type="text" id="filter-assignment-name" placeholder="Filter by Subcontractor Name" style="padding:7px 12px;border-radius:6px;border:1px solid #d1d5db;min-width:180px;max-width:220px;">
    <input type="text" id="filter-assignment-address" placeholder="Filter by Address" style="padding:7px 12px;border-radius:6px;border:1px solid #d1d5db;min-width:180px;max-width:220px;">
    <input type="text" id="filter-assignment-estimate" placeholder="Filter by Estimate" style="padding:7px 12px;border-radius:6px;border:1px solid #d1d5db;min-width:180px;max-width:220px;">
    <select id="filter-assignment-status" style="padding:7px 12px;border-radius:6px;border:1px solid #d1d5db;min-width:160px;max-width:200px;">
      <option value="">All Statuses</option>
      <option value="in-progress">In Progress</option>
      <option value="completed">Completed</option>
      <option value="approved">Approved</option>
      <option value="rework">Rework</option>
    </select>
  </div>
  <table id="assignments-table" style="width:100%; border-collapse:collapse;">
    <thead>
      <tr>
        <th>Subcontractor</th>
        <th>Project Address</th>
        <th>Estimate</th>
        <th>Line Items (<span title="Click to view details">#</span>)</th>
        <th>Date Requested</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Duration (days)</th>
        <th>Total Assignment</th>
      </tr>
    </thead>
    <tbody>
      <!-- Populated by JS -->
    </tbody>
  </table>
</section>

<!-- Modal for Line Item Details -->
<div id="lineItemsModal" class="modal">
  <div class="modal-content" style="max-width:950px;">
    <span class="close" id="closeLineItemsModal">&times;</span>
    <h3>Line Item Details</h3>
    <table id="lineItemsDetailsTable" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th>Name</th>
          <th>Status</th>
          <th>Date Requested</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Duration (days)</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>
</div>


      
    <section id="map-section">
      <h3>Project Locations</h3>
      <div id="map"></div>
  </section>
      
     <div id="projectFilters" style="display: flex; gap: 12px; padding: 0px 0; flex-wrap: wrap;">
     <label><input type="checkbox" value="active" checked> ðŸŸ¢ Active</label>
    <label><input type="checkbox" value="upcoming" checked> ðŸŸ  Upcoming</label>
    <label><input type="checkbox" value="completed" checked> ðŸ”µ Completed</label>
    <label><input type="checkbox" value="onMarket" checked> ðŸ”´ On Market</label>
    </div>

   <!-- Daily Updates Panel -->
<div id="daily-updates-panel">

  <!-- Tabs for Updates and Tasks -->
  <div class="updates-tasks-tabs">
    <button class="tab-btn active" data-tab="updates">Updates</button>
    <button class="tab-btn" data-tab="tasks">Tasks</button>
  </div>

  <!-- Updates Tab Content -->
  <div id="updates-tab-content">
    <h3>Daily Updates</h3>
    <input type="date" id="date-picker">
    <div id="daily-updates-feed">
      <p>Loading updates...</p>
    </div>
  </div>

  <!-- Tasks Tab Content -->
  <div id="tasks-tab-content" style="display:none;">
    <h3 style="display:inline-flex;align-items:center;gap:10px;">
  All Tasks
<button id="add-task-btn" title="Add New Task" style="
  background: linear-gradient(90deg,#2563eb 0%,#3b82f6 100%);
  color: #fff;
  border: none;
  border-radius: 10px;
  width: 30px;
  height: 30px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 16px !important;
  margin-left: 130px;
  cursor: pointer;
  box-shadow: 0 2px 8px #2563eb22;
  transition: background 0.18s, box-shadow 0.18s, transform 0.15s;
  outline: none;
"
>
  <i class="fas fa-plus"></i>
</button>
</h3>


    <!-- Place this above your #all-tasks-feed container -->
<div id="task-filters" style="width:100%;margin-bottom:0;">
  <select id="combined-task-filter">
    <option value="">All Tasks</option>
    <optgroup label="Status">
      <option value="status:open">Status: Open</option>
      <option value="status:completed">Status: Completed</option>
    </optgroup>
    <optgroup label="Assigned"></optgroup>
    <optgroup label="Project"></optgroup>
  </select>
  <!-- Active filter badges will be injected below -->
</div>
<div id="active-task-filters"></div>

    <div id="all-tasks-feed">
      <p>Loading tasks...</p>
    </div>
  </div>
</div>    

    <!-- Subcontractors Inline Section (replaces modal) -->
<section id="subcontractors-section" style="display:none; margin-top: 28px;">
  <div class="subcontractors-toolbar">
    <h2>Manage Subcontractors</h2>
    <div class="toolbar-actions">
      <input type="text" id="vendorSearch" class="subcontractors-search" placeholder="Search subcontractors..." />
      <button id="toggleAddVendor" class="icon-button" title="Add Subcontractor"><i class="fas fa-plus"></i></button>
      <!-- Back to Dashboard button is now injected by JS only to avoid duplicates -->
    </div>
  </div>

  <!-- Collapsible Add Vendor Panel -->
  <div id="addVendorPanel" class="collapsible" style="display:none;">
    <form id="addVendorForm" class="add-vendor-form">
      <input type="text" id="vendorName" placeholder="Full name" required />
      <input type="text" id="vendorTitle" placeholder="Title (e.g., Owner)" />
      <input type="email" id="vendorEmail" placeholder="Email" />
      <input type="tel" id="vendorPhone" placeholder="Phone" />
      <!-- New: Status dropdown to allow manual status management -->
      <select id="vendorStatus" class="vendor-status-select" style="min-height:38px;">
        <option value="inactive" selected>Inactive</option>
        <option value="active">Active</option>
      </select>
      <div style="grid-column: 1 / -1; display:flex; align-items:center; gap:8px;">
        <button type="submit" id="vendorFormSubmit" class="btn-primary">Add</button>
        <button type="button" id="vendorFormCancel" class="btn-secondary" style="display:none;">Cancel</button>
      </div>
    </form>
  </div>

  <div class="subcontractors-content-grid">
    <!-- Vendor Table Only -->
    <div>
      <table id="vendorTable" class="vendor-table">
        <thead>
          <tr>
            <th style="width:22%;">Name</th>
            <th style="width:18%;">Title</th>
            <th style="width:10%;">Status</th>
            <th style="width:20%;">Email</th>
            <th style="width:12%;">Phone</th>
            <th style="width:8%;">W9</th>
            <th style="width:10%; text-align:right;">Actions</th>
          </tr>
        </thead>
        <tbody id="vendorTableBody"><!-- populated by JS --></tbody>
      </table>
    </div>
  </div>
</section>

<!-- Custom Report Modal -->
<div id="customReportModal" class="modal">
  <div class="modal-content report-modal" style="max-width:1200px;">
    <div class="report-modal-header">
      <h2 class="report-modal-title">Generate Custom Report</h2>
      <span class="close" id="closeCustomReportModal" aria-label="Close">&times;</span>
    </div>
    <form id="customReportForm" class="report-form">
      <div class="report-grid">
        <section class="report-section">
          <label for="reportProjectSelect" class="report-label">Select Project</label>
          <select id="reportProjectSelect" class="report-select" required>
            <option value="">-- Select Project --</option>
          </select>
          <div id="reportFiltersPlaceholder" class="report-filters">
            <div class="report-filters-title">Filters</div>
            <!-- Status & Subcontractor filters will be injected here by script.js -->
          </div>
        </section>

        <section class="report-section">
          <div class="report-label">Select Columns</div>
          <div class="checkbox-grid">
            <label><input type="checkbox" name="columns" value="name" checked> Item Name</label>
            <label><input type="checkbox" name="columns" value="description" checked> Description</label>
            <label><input type="checkbox" name="columns" value="status" checked> Status</label>
            <label><input type="checkbox" name="columns" value="subcontractor" checked> Subcontractor</label>
            <label><input type="checkbox" name="columns" value="laborCost" checked> Labor Cost to Date</label>
            <label><input type="checkbox" name="columns" value="materialCost" checked> Material Cost to Date</label>
            <label><input type="checkbox" name="columns" value="total" checked> Total</label>
            <label><input type="checkbox" name="columns" value="profit" checked> Profit</label>
          </div>
        </section>
      </div>

      <section class="report-section">
        <div class="report-label">Summary Options</div>
        <div class="summary-options">
          <label class="summary-chip">
            <input type="checkbox" name="summary" value="actualCost" checked> Completed Budget to Date
          </label>
          <label class="summary-chip">
            <input type="checkbox" name="summary" value="totalBudget" checked> Estimate At Completion
          </label>
          <label class="summary-chip">
            <input type="checkbox" name="summary" value="budgetRemaining" checked> Budget Remaining
          </label>
          <label class="summary-chip">
            <input type="checkbox" name="summary" value="percentComplete" checked> Percent Complete Bar
          </label>
        </div>
      </section>

      <div class="report-actions">
        <button type="submit" class="btn-primary">Generate Report</button>
      </div>
    </form>
    <div id="customReportResult" class="report-result"></div>
  </div>
</div>
      

<!-- Toast Notification -->
<div id="toast" style="
  position: fixed;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: linear-gradient(to right, #0ea5e9, #3b82f6);
  color: white;
  padding: 14px 24px;
  border-radius: 8px;
  display: none;
  z-index: 9999;
  font-weight: 500;
  font-size: 15px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: none;
"></div>

<!-- Loader Spinner -->
<div id="loader" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255, 255, 255, 0.6);
  backdrop-filter: blur(2px);
  z-index: 9999;
  display: none;
  justify-content: center;
  align-items: center;
">
  <div style="
    border: 5px solid #e5e7eb;
    border-top: 5px solid #3b82f6;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    animation: spin 0.8s linear infinite;
  "></div>
</div>

<!-- Add this to your <style> block or <head> -->
<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

      
<!-- âœ… Google Maps API -->
<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvzkKpCkAY2PHwU8I8zZiM_FLMzMj1bbg&callback=initMap"
  async defer
></script>

<!-- âœ… MarkerClusterer -->
<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

<!-- âœ… Your custom script -->
<script src="script.js"></script>

<!-- Bottom Toolbar for Mobile -->
<nav class="bottom-toolbar">
   <a href="index.html" class="toolbar-icon" id="toolbar-home">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </a>
  <a href="quotes.html" class="toolbar-icon menu-link" id="toolbar-quotes">
    <i class="fas fa-file-invoice-dollar"></i>
    <span>Quotes</span>
  </a>
  <a href="#" class="toolbar-icon menu-link" id="toolbar-add">
    <i class="fas fa-plus-circle"></i>
    <span></span>
  </a>
  <a href="#" class="toolbar-icon menu-link" id="toolbar-daily">
    <i class="fas fa-sync-alt"></i>
    <span>Updates</span>
  </a>
  <a href="#" class="toolbar-icon menu-link" id="toolbar-more">
    <i class="fas fa-ellipsis-h"></i>
    <span>More</span>
  </a>
</nav>
     
<!-- Modal for adding a new task -->
<div id="addTaskModal" class="modal" style="display:none;">
  <div class="modal-content" style="max-width:420px;">
    <span class="close" id="closeAddTaskModal" style="position:absolute;top:6px;right:18px;font-size:1.5rem;cursor:pointer;">&times;</span>
    <h3>Add New Task</h3>
    <form id="addTaskForm">
      <label>Title:</label>
      <input type="text" id="newTaskTitle" required />
      <label>Description:</label>
      <textarea id="newTaskDesc"></textarea>
      <label>Due Date:</label>
      <input type="date" id="newTaskDueDate" />
      <label>Project:</label>
      <select id="newTaskProject" required></select>
        <label>Assign To:</label>
  <select id="newTaskAssignedTo" required>
    <option value="">-- Select --</option>
  </select>
      <button type="submit" style="margin-top:12px;">Add Task</button>
    </form>
  </div>
</div>

     
</body>

</html>




